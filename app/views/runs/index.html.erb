<% hierarchy = { }
    @runs.each do |run|   
        if hierarchy[run.category]
            if hierarchy[run.category][run.sub_category] 
                hierarchy[run.category][run.sub_category].push run
            else
                hierarchy[run.category][run.sub_category] = [run]
            end
        else 
            hierarchy[run.category] = {run.sub_category => [run] }
        end
    end 

    hierarchy = hierarchy.sort_by { |k,v| if k == "Sorting" then 0 elsif k == "Container" then 2 else 3 end }.to_h
    categories = hierarchy.keys

    def get_key_from_subcategory(input)
        capture = input.scan(/[1-9]?[0-9]/).last.to_i      
        return capture
    end
%>

<%= javascript_tag do %> 
    $(document).ready(function() {
       // $('#container').fadeOut(0);
       // $('#container').fadeIn();
    });
    
<% end %>

<div id="container" style="visibility:visible" class="container-fluid" style="width:100%">
    <div id="top" class="row" style="background-color:#E5E8E8;">
        <div class="col-xs-12"> 
            <a style="text-decoration:none" href="<%= runs_path %>"><h1>Algorithm Benchmarks</h1></a>
        </div>
    </div>
    <%  hierarchy.each do |category, v| %>
        <div class="row">
            <div style="col-xs-12" >
                <div id="<%= category %>" style="height:10px;"><br></div>
            </div>
         </div>
        <div class="row" style="padding:0px 0; border-bottom:solid 0px ;">
            <div class="col-xs-12">
                <h2  style="color:#626567; display:inline-block; padding-right:20px"><%= category %></h2>
                <% categories.each do |ca | %>
                    <% if ca != category %>
                        <a href="#<%= ca %>"><button id="<%= category %>" style="color:#626567; display:inline-block;padding-right:10px"><%= ca %>
                            </button></a>
                    <% end %>
                <% end %>
                
                <a href="#top">Top</a>
            </div>  
        </div>
           
        <% num_cols = 4
            vw_size = 80 / num_cols 
            bootstrap_arg = 12 / num_cols %>

        <% v.sort_by {|(e1,e2)| get_key_from_subcategory(e1) } .each do |sub_category, run_array| %>
        <div class="row" style="margin-top: 10px;margin-bottom: 20px;">    
            <%= javascript_tag do %> 
                var randomColorSet = getRandomColorSet();
                var colorGenerator = getColorGenerator(randomColorSet);
                //setCookie('r', randomColorSet[0], 1);
                //setCookie('g', randomColorSet[1], 1);
                // setCookie('b', randomColorSet[2], 1);
                //setCookie('shadePart', randomColorSet[3], 1);
            <% end %>
            <div class="col-xs-12" style="border-top:solid 1px;">
                <h4 style="padding-top: 10px;"><%= sub_category %></h4>
            </div>
        </div>
        <div class="row">
            <% run_array.sort_by { |x| x.order }.each_with_index do |run, i| %>
                <% chart_type = "horizontalBar"
                    if run.category == "Paiza" then chart_type = "line" end %>
                <div class="col-xs-<%= bootstrap_arg %>">
                    <div style="width:<%= vw_size %>vw;" onclick="location.assign('/runs/<%= run.id %>')">
                        <canvas id="<%= run.id %>" width="300" height="300"></canvas>
                        <%= javascript_tag do %>  
                            Chart.defaults.global.defaultFontSize = 10;                            
                            //Chart.options. = false;
                            var chartType = "<%= chart_type %>";
                            var myChart = drawChart("<%= run.id %>", 
                                JSON.parse('<%= run.data["algorithms"].to_json.html_safe %>'), 
                                JSON.parse('<%= run.data["results"].to_json.html_safe %>'),  
                                JSON.parse('<%= run.data["test_cases"].to_json.html_safe %>'), 
                                "<%= run.title %>", "<%= run.data["unit"] %>", colorGenerator, 2000, chartType);  
                            myChart.options.legend.labels.fontSize = 10;
                            myChart.options.legend.labels.boxWidth = 20;
                            myChart.options.title.fontSize = 15;
                            //myChart.resize(300, 300);
                                
                        <% end %>
                    </div>
                </div>
            <% end %> 
        </div>   
        <% end %>       
    <% end %>

    <div class="row">
        <div style="col-xs-12" >
            <div style="height:1000px;"><br></div>
        </div>
    </div>
</div>